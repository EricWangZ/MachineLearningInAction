
#coding=utf-8

from sys import path
#path.append(r'C:\Users\eyuiwng\Desktop\Study\machine learning\workspace\Ch09')
path.append(r'D:\Study\Workspaces\MyEclipse 2015\MachineLearningInAction\Ch09')

from numpy import *
import myRegTrees

# 第九章 树回归

# 9.1 复杂数据的局部性建模
# CART（Classification And Regression Trees, 分类回归树）

# 9.2 连续和离散型特征的树的构建
testMat = mat(eye(4))
print testMat

mat0,mat1 = myRegTrees.binSplitDataSet(testMat, 1, 0.5)
print mat0  # [[ 0.  1.  0.  0.]]
print mat1  # [[ 1.  0.  0.  0.]]

# 9.3 将CART算法用于回归
# 9.3.1 构建树

myDat = myRegTrees.loadDataSet('ex00.txt')
myMat = mat(myDat)
myRegTrees.createTree(myMat)
# {'spInd': 0, 'spVal': 0.48813, 'right': -0.044650285714285719, 'left': 1.0180967672413792}

myDat1 = myRegTrees.loadDataSet('ex0.txt')
myMat1 = mat(myDat1)
myRegTrees.createTree(myMat1)
#{'spInd': 1, 'spVal': 0.39435, 'right': {'spInd': 1, 'spVal': 0.197834, 'right': -0.023838155555555553, 'left': 1.0289583666666666}, 'left': {'spInd': 1, 'spVal': 0.582002, 'right': 1.980035071428571, 'left': {'spInd': 1, 'spVal': 0.797583, 'right': 2.9836209534883724, 'left': 3.9871631999999999}}}


### import treePlotter
### treePlotter.createPlot(myRegTrees.createTree(myMat))


# 9.4 树剪枝（tree pruning）
# 9.4.1 预剪枝 （prepruning）
# sensitive to tolS, tolN

myRegTrees.createTree(myMat, ops=(0,1))
#{'spInd': 0, 'spVal': 0.48813, 'right': {'spInd': 0, 'spVal': 0.343479, 'right': {'spInd': 0, 'spVal': 0.325412, 'right': {'spInd': 0, 'spVal': 0.048014, 'right': {'spInd': 0, 'spVal': 0.014083, 'right': {'spInd': 0, 'spVal': 0.009849, 'right': {'spInd': 0, 'spVal': 0.008307, 'right': {'spInd': 0, 'spVal': 0.000234, 'right': 0.060902999999999999, 'left': {'spInd': 0, 'spVal': 0.007044, 'right': 0.094149999999999998, 'left': 0.069975999999999997}}, 'left': 0.056593999999999998}, 'left': -0.132525}, 'left': {'spInd': 0, 'spVal': 0.036492, 'right': {'spInd': 0, 'spVal': 0.036098, 'right': 0.15509600000000001, 'left': 0.40815499999999999}, 'left': 0.064495999999999998}}, 'left': {'spInd': 0, 'spVal': 0.081931, 'right': {'spInd': 0, 'spVal': 0.071769, 'right': {'spInd': 0, 'spVal': 0.065615, 'right': -0.30697000000000002, 'left': {'spInd': 0, 'spVal': 0.066172, 'right': 0.052439, 'left': -0.110946}}, 'left': {'spInd': 0, 'spVal': 0.074795, 'right': {'spInd': 0, 'spVal': 0.072243, 'right': -0.420983, 'left': -0.349692}, 'left': -0.269756}}, 'left': {'spInd': 0, 'spVal': 0.188218, 'right': {'spInd': 0, 'spVal': 0.1333, 'right': {'spInd': 0, 'spVal': 0.130962, 'right': {'spInd': 0, 'spVal': 0.118156, 'right': {'spInd': 0, 'spVal': 0.096994, 'right': {'spInd': 0, 'spVal': 0.091358, 'right': {'spInd': 0, 'spVal': 0.084248, 'right': -0.019546999999999998, 'left': 0.099934999999999996}, 'left': 0.22716700000000001}, 'left': {'spInd': 0, 'spVal': 0.098016, 'right': -0.33276, 'left': {'spInd': 0, 'spVal': 0.101149, 'right': {'spInd': 0, 'spVal': 0.099142, 'right': 0.02528, 'left': 0.068834000000000006}, 'left': -0.077409000000000006}}}, 'left': {'spInd': 0, 'spVal': 0.129061, 'right': 0.30510700000000002, 'left': {'spInd': 0, 'spVal': 0.130052, 'right': -0.026166999999999999, 'left': 0.18424099999999999}}}, 'left': {'spInd': 0, 'spVal': 0.132543, 'right': -0.329372, 'left': -0.22314300000000001}}, 'left': {'spInd': 0, 'spVal': 0.146366, 'right': {'spInd': 0, 'spVal': 0.145809, 'right': 0.13697899999999999, 'left': 0.034283000000000001}, 'left': {'spInd': 0, 'spVal': 0.148049, 'right': 0.20429800000000001, 'left': {'spInd': 0, 'spVal': 0.180506, 'right': {'spInd': 0, 'spVal': 0.152324, 'right': 0.132858, 'left': 0.103676}, 'left': {'spInd': 0, 'spVal': 0.18351, 'right': 0.18484300000000001, 'left': 0.11368499999999999}}}}}, 'left': {'spInd': 0, 'spVal': 0.23807, 'right': {'spInd': 0, 'spVal': 0.210334, 'right': {'spInd': 0, 'spVal': 0.193641, 'right': -0.32758900000000002, 'left': {'spInd': 0, 'spVal': 0.203693, 'right': {'spInd': 0, 'spVal': 0.196005, 'right': -0.048847000000000002, 'left': {'spInd': 0, 'spVal': 0.202054, 'right': -0.087744000000000003, 'left': -0.064035999999999996}}, 'left': -0.0068989999999999998}}, 'left': {'spInd': 0, 'spVal': 0.233115, 'right': -0.34814699999999998, 'left': -0.35845900000000003}}, 'left': {'spInd': 0, 'spVal': 0.242204, 'right': 0.20935899999999999, 'left': {'spInd': 0, 'spVal': 0.323181, 'right': {'spInd': 0, 'spVal': 0.314924, 'right': {'spInd': 0, 'spVal': 0.27394, 'right': {'spInd': 0, 'spVal': 0.268857, 'right': {'spInd': 0, 'spVal': 0.252649, 'right': {'spInd': 0, 'spVal': 0.250744, 'right': {'spInd': 0, 'spVal': 0.243909, 'right': -0.029467, 'left': 0.046296999999999998}, 'left': -0.055613000000000003}, 'left': 0.073446999999999998}, 'left': {'spInd': 0, 'spVal': 0.273147, 'right': {'spInd': 0, 'spVal': 0.269681, 'right': -0.16597100000000001, 'left': -0.45521899999999998}, 'left': -0.085712999999999998}}, 'left': {'spInd': 0, 'spVal': 0.278661, 'right': 0.25362800000000002, 'left': {'spInd': 0, 'spVal': 0.280738, 'right': -0.22888, 'left': {'spInd': 0, 'spVal': 0.302001, 'right': {'spInd': 0, 'spVal': 0.295511, 'right': 0.002882, 'left': 0.317135}, 'left': {'spInd': 0, 'spVal': 0.306964, 'right': {'spInd': 0, 'spVal': 0.30554, 'right': {'spInd': 0, 'spVal': 0.302217, 'right': -0.14865, 'left': -0.115991}, 'left': -0.17732100000000001}, 'left': -0.001952}}}}}, 'left': 0.180811}, 'left': -0.219245}}}}}}, 'left': {'spInd': 0, 'spVal': 0.3371, 'right': {'spInd': 0, 'spVal': 0.332982, 'right': 0.21008399999999999, 'left': 0.026332000000000001}, 'left': {'spInd': 0, 'spVal': 0.339563, 'right': 0.20678299999999999, 'left': 0.175264}}}, 'left': {'spInd': 0, 'spVal': 0.406649, 'right': {'spInd': 0, 'spVal': 0.355688, 'right': {'spInd': 0, 'spVal': 0.343554, 'right': -0.37169999999999997, 'left': {'spInd': 0, 'spVal': 0.347837, 'right': {'spInd': 0, 'spVal': 0.344102, 'right': -0.061539000000000003, 'left': {'spInd': 0, 'spVal': 0.346986, 'right': -0.15038899999999999, 'left': -0.15340500000000001}}, 'left': {'spInd': 0, 'spVal': 0.348013, 'right': 0.048939000000000003, 'left': -0.11939900000000001}}}, 'left': {'spInd': 0, 'spVal': 0.362314, 'right': {'spInd': 0, 'spVal': 0.360323, 'right': -0.20483000000000001, 'left': -0.55646399999999996}, 'left': {'spInd': 0, 'spVal': 0.377597, 'right': {'spInd': 0, 'spVal': 0.377201, 'right': -0.24354999999999999, 'left': 0.088505}, 'left': {'spInd': 0, 'spVal': 0.401152, 'right': {'spInd': 0, 'spVal': 0.378595, 'right': -0.29609400000000002, 'left': -0.12164}, 'left': -0.366317}}}}, 'left': {'spInd': 0, 'spVal': 0.41023, 'right': 0.33172200000000002, 'left': {'spInd': 0, 'spVal': 0.458121, 'right': {'spInd': 0, 'spVal': 0.429664, 'right': -0.18865899999999999, 'left': {'spInd': 0, 'spVal': 0.44928, 'right': {'spInd': 0, 'spVal': 0.448656, 'right': {'spInd': 0, 'spVal': 0.438367, 'right': 0.034014000000000003, 'left': 0.026974000000000001}, 'left': 0.069098000000000007}, 'left': -0.061455999999999997}}, 'left': {'spInd': 0, 'spVal': 0.475976, 'right': {'spInd': 0, 'spVal': 0.465625, 'right': -0.15293999999999999, 'left': -0.16370699999999999}, 'left': -0.097791000000000003}}}}}, 'left': {'spInd': 0, 'spVal': 0.620599, 'right': {'spInd': 0, 'spVal': 0.61127, 'right': {'spInd': 0, 'spVal': 0.517921, 'right': {'spInd': 0, 'spVal': 0.514563, 'right': {'spInd': 0, 'spVal': 0.50794, 'right': 1.1072649999999999, 'left': 1.1566479999999999}, 'left': 1.4935860000000001}, 'left': {'spInd': 0, 'spVal': 0.541314, 'right': {'spInd': 0, 'spVal': 0.520207, 'right': {'spInd': 0, 'spVal': 0.520044, 'right': {'spInd': 0, 'spVal': 0.518735, 'right': 1.0371790000000001, 'left': 0.96198300000000003}, 'left': 1.209557}, 'left': {'spInd': 0, 'spVal': 0.536689, 'right': {'spInd': 0, 'spVal': 0.529491, 'right': {'spInd': 0, 'spVal': 0.527505, 'right': 0.87956000000000001, 'left': 1.0222059999999999}, 'left': {'spInd': 0, 'spVal': 0.530897, 'right': 0.89346199999999998, 'left': 0.86728400000000005}}, 'left': {'spInd': 0, 'spVal': 0.539558, 'right': 1.0538460000000001, 'left': 0.89374799999999999}}}, 'left': {'spInd': 0, 'spVal': 0.559763, 'right': {'spInd': 0, 'spVal': 0.552381, 'right': 1.3696299999999999, 'left': {'spInd': 0, 'spVal': 0.55299, 'right': 1.0361579999999999, 'left': {'spInd': 0, 'spVal': 0.55352, 'right': 1.391273, 'left': 1.2531509999999999}}}, 'left': {'spInd': 0, 'spVal': 0.590062, 'right': {'spInd': 0, 'spVal': 0.589575, 'right': {'spInd': 0, 'spVal': 0.575805, 'right': {'spInd': 0, 'spVal': 0.574573, 'right': {'spInd': 0, 'spVal': 0.561362, 'right': 1.0705290000000001, 'left': {'spInd': 0, 'spVal': 0.567704, 'right': 0.96905799999999997, 'left': 1.06613}}, 'left': 0.89908999999999994}, 'left': {'spInd': 0, 'spVal': 0.576946, 'right': 1.234129, 'left': {'spInd': 0, 'spVal': 0.578252, 'right': 0.92188499999999995, 'left': 1.1858120000000001}}}, 'left': 0.70553100000000002}, 'left': {'spInd': 0, 'spVal': 0.595012, 'right': {'spInd': 0, 'spVal': 0.59021, 'right': 1.3366610000000001, 'left': 1.213435}, 'left': {'spInd': 0, 'spVal': 0.597409, 'right': 0.97477000000000003, 'left': {'spInd': 0, 'spVal': 0.604529, 'right': 1.212685, 'left': 0.98203600000000002}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.613765, 'right': 1.6210910000000001, 'left': 1.3344210000000001}}, 'left': {'spInd': 0, 'spVal': 0.625336, 'right': {'spInd': 0, 'spVal': 0.622398, 'right': 0.76632999999999996, 'left': 0.62369600000000003}, 'left': {'spInd': 0, 'spVal': 0.625791, 'right': 1.244731, 'left': {'spInd': 0, 'spVal': 0.643601, 'right': {'spInd': 0, 'spVal': 0.626011, 'right': 0.84054399999999996, 'left': 0.78255200000000003}, 'left': {'spInd': 0, 'spVal': 0.651376, 'right': {'spInd': 0, 'spVal': 0.645762, 'right': {'spInd': 0, 'spVal': 0.643665, 'right': 1.024241, 'left': 1.026886}, 'left': {'spInd': 0, 'spVal': 0.648675, 'right': 1.287407, 'left': 1.3153840000000001}}, 'left': {'spInd': 0, 'spVal': 0.6632, 'right': {'spInd': 0, 'spVal': 0.656218, 'right': {'spInd': 0, 'spVal': 0.652121, 'right': 1.004346, 'left': 0.95850599999999997}, 'left': {'spInd': 0, 'spVal': 0.661923, 'right': 0.76704000000000006, 'left': 0.70163399999999998}}, 'left': {'spInd': 0, 'spVal': 0.683921, 'right': {'spInd': 0, 'spVal': 0.683886, 'right': {'spInd': 0, 'spVal': 0.678287, 'right': {'spInd': 0, 'spVal': 0.66387, 'right': 1.1871290000000001, 'left': {'spInd': 0, 'spVal': 0.673195, 'right': 0.91507700000000003, 'left': 0.90772699999999995}}, 'left': {'spInd': 0, 'spVal': 0.67939, 'right': 1.3072170000000001, 'left': 0.99998500000000001}}, 'left': 1.414382}, 'left': {'spInd': 0, 'spVal': 0.819823, 'right': {'spInd': 0, 'spVal': 0.785541, 'right': {'spInd': 0, 'spVal': 0.712503, 'right': {'spInd': 0, 'spVal': 0.703755, 'right': {'spInd': 0, 'spVal': 0.696648, 'right': {'spInd': 0, 'spVal': 0.691115, 'right': 0.83439099999999999, 'left': 0.84542300000000004}, 'left': {'spInd': 0, 'spVal': 0.697718, 'right': 1.212434, 'left': {'spInd': 0, 'spVal': 0.697777, 'right': 0.82780500000000001, 'left': 1.1016779999999999}}}, 'left': {'spInd': 0, 'spVal': 0.712386, 'right': 0.56485799999999997, 'left': 0.93349000000000004}}, 'left': {'spInd': 0, 'spVal': 0.72312, 'right': 1.307248, 'left': {'spInd': 0, 'spVal': 0.768784, 'right': {'spInd': 0, 'spVal': 0.742527, 'right': {'spInd': 0, 'spVal': 0.729234, 'right': {'spInd': 0, 'spVal': 0.727098, 'right': {'spInd': 0, 'spVal': 0.726828, 'right': 1.017112, 'left': 1.000567}, 'left': 0.93195600000000001}, 'left': {'spInd': 0, 'spVal': 0.737189, 'right': 1.2007810000000001, 'left': 1.087056}}, 'left': {'spInd': 0, 'spVal': 0.750918, 'right': {'spInd': 0, 'spVal': 0.750078, 'right': 0.90629099999999996, 'left': 0.74810399999999999}, 'left': {'spInd': 0, 'spVal': 0.761474, 'right': 1.058262, 'left': {'spInd': 0, 'spVal': 0.768596, 'right': 0.76021899999999998, 'left': 0.89970499999999998}}}}, 'left': {'spInd': 0, 'spVal': 0.773422, 'right': {'spInd': 0, 'spVal': 0.772083, 'right': 1.299018, 'left': {'spInd': 0, 'spVal': 0.773168, 'right': 1.140917, 'left': 1.1259429999999999}}, 'left': {'spInd': 0, 'spVal': 0.782167, 'right': {'spInd': 0, 'spVal': 0.774301, 'right': 0.83676300000000003, 'left': {'spInd': 0, 'spVal': 0.78193, 'right': 1.0744880000000001, 'left': 0.88604899999999998}}, 'left': 1.1652960000000001}}}}}, 'left': {'spInd': 0, 'spVal': 0.79024, 'right': {'spInd': 0, 'spVal': 0.789625, 'right': 0.55261400000000005, 'left': 0.53321399999999997}, 'left': {'spInd': 0, 'spVal': 0.813719, 'right': {'spInd': 0, 'spVal': 0.804586, 'right': {'spInd': 0, 'spVal': 0.795072, 'right': 0.96572100000000005, 'left': 0.92403299999999999}, 'left': 0.70660100000000003}, 'left': {'spInd': 0, 'spVal': 0.814825, 'right': 1.0952059999999999, 'left': 0.83526400000000001}}}}, 'left': {'spInd': 0, 'spVal': 0.837522, 'right': {'spInd': 0, 'spVal': 0.821648, 'right': {'spInd': 0, 'spVal': 0.820802, 'right': 1.3259069999999999, 'left': 1.2808949999999999}, 'left': {'spInd': 0, 'spVal': 0.834078, 'right': {'spInd': 0, 'spVal': 0.824442, 'right': {'spInd': 0, 'spVal': 0.822443, 'right': 1.0866480000000001, 'left': 1.0821529999999999}, 'left': 1.01058}, 'left': 1.229373}}, 'left': {'spInd': 0, 'spVal': 0.846455, 'right': {'spInd': 0, 'spVal': 0.845815, 'right': 0.95261700000000005, 'left': 0.72002999999999995}, 'left': {'spInd': 0, 'spVal': 0.919384, 'right': {'spInd': 0, 'spVal': 0.877241, 'right': {'spInd': 0, 'spVal': 0.848921, 'right': 1.1709590000000001, 'left': {'spInd': 0, 'spVal': 0.860049, 'right': 0.71748999999999996, 'left': {'spInd': 0, 'spVal': 0.869077, 'right': 1.114825, 'left': 0.79700499999999996}}}, 'left': {'spInd': 0, 'spVal': 0.897094, 'right': {'spInd': 0, 'spVal': 0.89593, 'right': {'spInd': 0, 'spVal': 0.884512, 'right': 1.1178330000000001, 'left': 1.077275}, 'left': 1.2402089999999999}, 'left': {'spInd': 0, 'spVal': 0.902532, 'right': {'spInd': 0, 'spVal': 0.901056, 'right': {'spInd': 0, 'spVal': 0.900272, 'right': 0.99687099999999995, 'left': 1.0559000000000001}, 'left': 0.86160099999999995}, 'left': {'spInd': 0, 'spVal': 0.919074, 'right': 1.123413, 'left': 1.0298890000000001}}}}, 'left': {'spInd': 0, 'spVal': 0.976414, 'right': {'spInd': 0, 'spVal': 0.953112, 'right': {'spInd': 0, 'spVal': 0.948268, 'right': {'spInd': 0, 'spVal': 0.936783, 'right': {'spInd': 0, 'spVal': 0.928097, 'right': 0.88322500000000004, 'left': {'spInd': 0, 'spVal': 0.930173, 'right': 1.0356449999999999, 'left': 1.0262579999999999}}, 'left': 0.63186200000000003}, 'left': {'spInd': 0, 'spVal': 0.951949, 'right': {'spInd': 0, 'spVal': 0.950153, 'right': 1.0229060000000001, 'left': 0.94525499999999996}, 'left': 1.0646899999999999}}, 'left': {'spInd': 0, 'spVal': 0.975022, 'right': 0.67357900000000004, 'left': 0.86291099999999998}}, 'left': {'spInd': 0, 'spVal': 0.985425, 'right': 1.227946, 'left': {'spInd': 0, 'spVal': 0.989888, 'right': {'spInd': 0, 'spVal': 0.988852, 'right': 1.069062, 'left': 0.74420699999999995}, 'left': {'spInd': 0, 'spVal': 0.993349, 'right': 1.077553, 'left': 1.035533}}}}}}}}}}}}}}}}


myDat2 = myRegTrees.loadDataSet('ex2.txt')
myMat2 = mat(myDat2)
myRegTrees.createTree(myMat2)
#{'spInd': 0, 'spVal': 0.499171, 'right': {'spInd': 0, 'spVal': 0.457563, 'right': {'spInd': 0, 'spVal': 0.126833, 'right': {'spInd': 0, 'spVal': 0.084661, 'right': {'spInd': 0, 'spVal': 0.044737, 'right': 4.0916259999999998, 'left': -2.5443927142857148}, 'left': 6.5098432857142843}, 'left': {'spInd': 0, 'spVal': 0.373501, 'right': {'spInd': 0, 'spVal': 0.335182, 'right': {'spInd': 0, 'spVal': 0.324274, 'right': {'spInd': 0, 'spVal': 0.297107, 'right': {'spInd': 0, 'spVal': 0.166765, 'right': {'spInd': 0, 'spVal': 0.156067, 'right': -6.2479000000000013, 'left': -12.107972500000001}, 'left': {'spInd': 0, 'spVal': 0.202161, 'right': 3.4496025000000001, 'left': {'spInd': 0, 'spVal': 0.217214, 'right': -11.822278500000001, 'left': {'spInd': 0, 'spVal': 0.228473, 'right': 6.770429, 'left': {'spInd': 0, 'spVal': 0.25807, 'right': -13.070501, 'left': 0.40377471428571476}}}}}, 'left': -19.994155200000002}, 'left': 15.059290750000001}, 'left': {'spInd': 0, 'spVal': 0.350725, 'right': -22.693879600000002, 'left': -15.085111749999999}}, 'left': {'spInd': 0, 'spVal': 0.437652, 'right': {'spInd': 0, 'spVal': 0.412516, 'right': {'spInd': 0, 'spVal': 0.385021, 'right': 3.6584772500000016, 'left': -0.89235549999999952}, 'left': 14.38417875}, 'left': -12.558604833333334}}}, 'left': {'spInd': 0, 'spVal': 0.467383, 'right': 3.4331330000000007, 'left': 12.50675925}}, 'left': {'spInd': 0, 'spVal': 0.729397, 'right': {'spInd': 0, 'spVal': 0.640515, 'right': {'spInd': 0, 'spVal': 0.613004, 'right': {'spInd': 0, 'spVal': 0.582311, 'right': {'spInd': 0, 'spVal': 0.553797, 'right': {'spInd': 0, 'spVal': 0.51915, 'right': 101.73699325000001, 'left': {'spInd': 0, 'spVal': 0.543843, 'right': 110.979946, 'left': 109.38961049999999}}, 'left': 97.200180249999988}, 'left': 123.2101316}, 'left': 93.673449714285724}, 'left': {'spInd': 0, 'spVal': 0.666452, 'right': 114.15162428571431, 'left': {'spInd': 0, 'spVal': 0.706961, 'right': {'spInd': 0, 'spVal': 0.698472, 'right': 108.92921799999999, 'left': 104.82495374999999}, 'left': 114.554706}}}, 'left': {'spInd': 0, 'spVal': 0.952833, 'right': {'spInd': 0, 'spVal': 0.759504, 'right': 78.085643250000004, 'left': {'spInd': 0, 'spVal': 0.790312, 'right': 102.35780185714285, 'left': {'spInd': 0, 'spVal': 0.833026, 'right': {'spInd': 0, 'spVal': 0.811602, 'right': 88.784498800000009, 'left': 81.110151999999999}, 'left': {'spInd': 0, 'spVal': 0.944221, 'right': {'spInd': 0, 'spVal': 0.85497, 'right': 95.275843166666661, 'left': {'spInd': 0, 'spVal': 0.910975, 'right': {'spInd': 0, 'spVal': 0.892999, 'right': {'spInd': 0, 'spVal': 0.872883, 'right': 102.25234449999999, 'left': 95.181792999999999}, 'left': 104.82540899999999}, 'left': 96.452866999999998}}, 'left': 87.310387500000004}}}}, 'left': {'spInd': 0, 'spVal': 0.958512, 'right': 112.42895575000001, 'left': 105.24862350000001}}}}

myRegTrees.createTree(myMat2, ops=(10000,4))
#{'spInd': 0, 'spVal': 0.499171, 'right': -2.6377193297872341, 'left': 101.35815937735848}


# 9.4.2 后剪枝 （postpruning） 
myDat2 = myRegTrees.loadDataSet('ex2.txt')
myMat2 = mat(myDat2)
myTree = myRegTrees.createTree(myMat2, ops=(0,1))
print myTree
#{'spInd': 0, 'spVal': 0.499171, 'right': {'spInd': 0, 'spVal': 0.457563, 'right': {'spInd': 0, 'spVal': 0.455761, 'right': {'spInd': 0, 'spVal': 0.126833, 'right': {'spInd': 0, 'spVal': 0.124723, 'right': {'spInd': 0, 'spVal': 0.085111, 'right': {'spInd': 0, 'spVal': 0.084661, 'right': {'spInd': 0, 'spVal': 0.080061, 'right': {'spInd': 0, 'spVal': 0.068373, 'right': {'spInd': 0, 'spVal': 0.061219, 'right': {'spInd': 0, 'spVal': 0.044737, 'right': {'spInd': 0, 'spVal': 0.028546, 'right': {'spInd': 0, 'spVal': 0.000256, 'right': 9.6681059999999999, 'left': -8.3770939999999996}, 'left': {'spInd': 0, 'spVal': 0.039914, 'right': 11.220098999999999, 'left': 3.8553929999999998}}, 'left': {'spInd': 0, 'spVal': 0.053764, 'right': -13.731698, 'left': {'spInd': 0, 'spVal': 0.055862, 'right': -3.131497, 'left': 6.6955669999999996}}}, 'left': -15.160836}, 'left': {'spInd': 0, 'spVal': 0.079632, 'right': 29.420068000000001, 'left': 2.229873}}, 'left': -24.132225999999999}, 'left': 37.820658999999999}, 'left': {'spInd': 0, 'spVal': 0.108801, 'right': {'spInd': 0, 'spVal': 0.10796, 'right': {'spInd': 0, 'spVal': 0.085873, 'right': -10.137104000000001, 'left': -1.2931950000000001}, 'left': -16.106164}, 'left': {'spInd': 0, 'spVal': 0.11515, 'right': 13.795828, 'left': -1.4027959999999999}}}, 'left': 22.891674999999999}, 'left': {'spInd': 0, 'spVal': 0.130626, 'right': -39.524461000000002, 'left': {'spInd': 0, 'spVal': 0.382037, 'right': {'spInd': 0, 'spVal': 0.335182, 'right': {'spInd': 0, 'spVal': 0.324274, 'right': {'spInd': 0, 'spVal': 0.309133, 'right': {'spInd': 0, 'spVal': 0.131833, 'right': 22.478290999999999, 'left': {'spInd': 0, 'spVal': 0.138619, 'right': -29.087463, 'left': {'spInd': 0, 'spVal': 0.156067, 'right': {'spInd': 0, 'spVal': 0.13988, 'right': 7.3367839999999998, 'left': 7.5573490000000003}, 'left': {'spInd': 0, 'spVal': 0.166765, 'right': {'spInd': 0, 'spVal': 0.156273, 'right': 0.225886, 'left': {'spInd': 0, 'spVal': 0.164134, 'right': -27.405211000000001, 'left': {'spInd': 0, 'spVal': 0.166431, 'right': -6.5125060000000001, 'left': -14.740059}}}, 'left': {'spInd': 0, 'spVal': 0.193282, 'right': {'spInd': 0, 'spVal': 0.176523, 'right': 0.94634799999999997, 'left': 18.208423}, 'left': {'spInd': 0, 'spVal': 0.211633, 'right': {'spInd': 0, 'spVal': 0.202161, 'right': {'spInd': 0, 'spVal': 0.199903, 'right': -3.3724720000000001, 'left': -1.983889}, 'left': {'spInd': 0, 'spVal': 0.203993, 'right': -22.379118999999999, 'left': {'spInd': 0, 'spVal': 0.206207, 'right': -12.619035999999999, 'left': -8.3322070000000004}}}, 'left': {'spInd': 0, 'spVal': 0.228473, 'right': {'spInd': 0, 'spVal': 0.222271, 'right': {'spInd': 0, 'spVal': 0.218321, 'right': {'spInd': 0, 'spVal': 0.217214, 'right': -3.958752, 'left': 1.410768}, 'left': -9.2558520000000009}, 'left': {'spInd': 0, 'spVal': 0.2232, 'right': 15.501642, 'left': 19.425158}}, 'left': {'spInd': 0, 'spVal': 0.25807, 'right': {'spInd': 0, 'spVal': 0.228628, 'right': -2.266273, 'left': {'spInd': 0, 'spVal': 0.228751, 'right': -30.812912000000001, 'left': {'spInd': 0, 'spVal': 0.232802, 'right': 1.222318, 'left': -20.425136999999999}}}, 'left': {'spInd': 0, 'spVal': 0.284794, 'right': {'spInd': 0, 'spVal': 0.273863, 'right': {'spInd': 0, 'spVal': 0.264926, 'right': {'spInd': 0, 'spVal': 0.264639, 'right': 2.5579230000000002, 'left': 5.2805790000000004}, 'left': -9.4575560000000003}, 'left': 35.623745999999997}, 'left': {'spInd': 0, 'spVal': 0.300318, 'right': {'spInd': 0, 'spVal': 0.297107, 'right': {'spInd': 0, 'spVal': 0.295993, 'right': {'spInd': 0, 'spVal': 0.290749, 'right': -14.391613, 'left': -14.988279}, 'left': -1.7983769999999999}, 'left': -18.051317999999998}, 'left': 8.8147249999999993}}}}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.310956, 'right': -49.939515999999998, 'left': {'spInd': 0, 'spVal': 0.318309, 'right': -27.605423999999999, 'left': -13.189242999999999}}}, 'left': {'spInd': 0, 'spVal': 0.32889, 'right': 39.783113, 'left': {'spInd': 0, 'spVal': 0.331364, 'right': -1.2908249999999999, 'left': {'spInd': 0, 'spVal': 0.3349, 'right': 18.976649999999999, 'left': 2.7682250000000002}}}}, 'left': {'spInd': 0, 'spVal': 0.370042, 'right': {'spInd': 0, 'spVal': 0.35679, 'right': {'spInd': 0, 'spVal': 0.350725, 'right': {'spInd': 0, 'spVal': 0.350065, 'right': {'spInd': 0, 'spVal': 0.342761, 'right': {'spInd': 0, 'spVal': 0.342155, 'right': {'spInd': 0, 'spVal': 0.3417, 'right': -23.547711, 'left': -16.930416000000001}, 'left': -31.584855000000001}, 'left': -1.319852}, 'left': -40.086564000000003}, 'left': {'spInd': 0, 'spVal': 0.351478, 'right': -0.46111600000000003, 'left': -19.526539}}, 'left': -32.124495000000003}, 'left': {'spInd': 0, 'spVal': 0.378965, 'right': {'spInd': 0, 'spVal': 0.373501, 'right': -8.2282969999999995, 'left': {'spInd': 0, 'spVal': 0.377383, 'right': 5.2411960000000004, 'left': 13.583555}}, 'left': -29.007783}}}, 'left': {'spInd': 0, 'spVal': 0.388789, 'right': {'spInd': 0, 'spVal': 0.385021, 'right': 24.816941, 'left': 21.578006999999999}, 'left': {'spInd': 0, 'spVal': 0.437652, 'right': {'spInd': 0, 'spVal': 0.412516, 'right': {'spInd': 0, 'spVal': 0.403228, 'right': {'spInd': 0, 'spVal': 0.391609, 'right': 3.0011040000000002, 'left': -1.729244}, 'left': -26.419288999999999}, 'left': {'spInd': 0, 'spVal': 0.418943, 'right': 44.161493, 'left': {'spInd': 0, 'spVal': 0.426711, 'right': -21.594268, 'left': {'spInd': 0, 'spVal': 0.428582, 'right': 15.224266, 'left': 19.745224}}}}, 'left': {'spInd': 0, 'spVal': 0.454312, 'right': {'spInd': 0, 'spVal': 0.446196, 'right': -5.1081719999999997, 'left': {'spInd': 0, 'spVal': 0.451087, 'right': -28.724685000000001, 'left': -20.360067000000001}}, 'left': {'spInd': 0, 'spVal': 0.454375, 'right': 3.0439120000000002, 'left': 9.8419380000000007}}}}}}}, 'left': -34.044555000000003}, 'left': {'spInd': 0, 'spVal': 0.465561, 'right': {'spInd': 0, 'spVal': 0.463241, 'right': 17.171057000000001, 'left': 30.051931}, 'left': {'spInd': 0, 'spVal': 0.467383, 'right': {'spInd': 0, 'spVal': 0.46568, 'right': -23.777531, 'left': -9.7129250000000003}, 'left': {'spInd': 0, 'spVal': 0.483803, 'right': 5.224234, 'left': {'spInd': 0, 'spVal': 0.487381, 'right': 27.729263, 'left': {'spInd': 0, 'spVal': 0.487537, 'right': 5.1493359999999999, 'left': 11.924204}}}}}}, 'left': {'spInd': 0, 'spVal': 0.729397, 'right': {'spInd': 0, 'spVal': 0.640515, 'right': {'spInd': 0, 'spVal': 0.613004, 'right': {'spInd': 0, 'spVal': 0.606417, 'right': {'spInd': 0, 'spVal': 0.513332, 'right': {'spInd': 0, 'spVal': 0.508548, 'right': {'spInd': 0, 'spVal': 0.508542, 'right': 96.403373000000002, 'left': 93.292828999999998}, 'left': 101.075609}, 'left': {'spInd': 0, 'spVal': 0.533511, 'right': {'spInd': 0, 'spVal': 0.51915, 'right': 116.17616200000001, 'left': {'spInd': 0, 'spVal': 0.531944, 'right': 124.795495, 'left': 129.76674299999999}}, 'left': {'spInd': 0, 'spVal': 0.548539, 'right': {'spInd': 0, 'spVal': 0.546601, 'right': {'spInd': 0, 'spVal': 0.537834, 'right': 90.995536000000001, 'left': {'spInd': 0, 'spVal': 0.543843, 'right': 98.362009999999998, 'left': 96.319042999999994}}, 'left': 83.114502000000002}, 'left': {'spInd': 0, 'spVal': 0.553797, 'right': {'spInd': 0, 'spVal': 0.549814, 'right': 137.26757599999999, 'left': 120.857321}, 'left': {'spInd': 0, 'spVal': 0.560301, 'right': 82.903944999999993, 'left': {'spInd': 0, 'spVal': 0.599142, 'right': {'spInd': 0, 'spVal': 0.589806, 'right': {'spInd': 0, 'spVal': 0.582311, 'right': {'spInd': 0, 'spVal': 0.571214, 'right': {'spInd': 0, 'spVal': 0.569327, 'right': 108.43539199999999, 'left': 114.872056}, 'left': 82.589327999999995}, 'left': {'spInd': 0, 'spVal': 0.585413, 'right': 125.295113, 'left': 98.674874000000003}}, 'left': 130.37852899999999}, 'left': 93.521395999999996}}}}}}, 'left': 168.180746}, 'left': {'spInd': 0, 'spVal': 0.623909, 'right': {'spInd': 0, 'spVal': 0.618868, 'right': 76.917665, 'left': 87.181863000000007}, 'left': {'spInd': 0, 'spVal': 0.628061, 'right': {'spInd': 0, 'spVal': 0.624827, 'right': 105.970743, 'left': 117.62834599999999}, 'left': {'spInd': 0, 'spVal': 0.637999, 'right': {'spInd': 0, 'spVal': 0.632691, 'right': 93.645292999999995, 'left': 91.656616999999997}, 'left': 82.713621000000003}}}}, 'left': {'spInd': 0, 'spVal': 0.642373, 'right': 140.61394100000001, 'left': {'spInd': 0, 'spVal': 0.642707, 'right': 82.500765999999999, 'left': {'spInd': 0, 'spVal': 0.665329, 'right': {'spInd': 0, 'spVal': 0.661073, 'right': {'spInd': 0, 'spVal': 0.652462, 'right': 112.715799, 'left': 115.687524}, 'left': 121.98060700000001}, 'left': {'spInd': 0, 'spVal': 0.706961, 'right': {'spInd': 0, 'spVal': 0.698472, 'right': {'spInd': 0, 'spVal': 0.689099, 'right': {'spInd': 0, 'spVal': 0.666452, 'right': {'spInd': 0, 'spVal': 0.665652, 'right': 105.547997, 'left': 120.014736}, 'left': {'spInd': 0, 'spVal': 0.667851, 'right': 92.449663999999999, 'left': {'spInd': 0, 'spVal': 0.680486, 'right': 110.367074, 'left': 112.378209}}}, 'left': 120.521925}, 'left': {'spInd': 0, 'spVal': 0.69892, 'right': 92.470635999999999, 'left': {'spInd': 0, 'spVal': 0.699873, 'right': 115.58660500000001, 'left': {'spInd': 0, 'spVal': 0.70639, 'right': 105.062147, 'left': 106.18042699999999}}}}, 'left': {'spInd': 0, 'spVal': 0.70889, 'right': 135.41676699999999, 'left': {'spInd': 0, 'spVal': 0.716211, 'right': {'spInd': 0, 'spVal': 0.710234, 'right': 108.55391899999999, 'left': 103.345308}, 'left': 110.90282999999999}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.952833, 'right': {'spInd': 0, 'spVal': 0.759504, 'right': {'spInd': 0, 'spVal': 0.740859, 'right': {'spInd': 0, 'spVal': 0.731636, 'right': 73.912028000000007, 'left': 93.773928999999995}, 'left': {'spInd': 0, 'spVal': 0.757527, 'right': 63.549854000000003, 'left': 81.106762000000003}}, 'left': {'spInd': 0, 'spVal': 0.763328, 'right': 115.199195, 'left': {'spInd': 0, 'spVal': 0.769043, 'right': 64.041940999999994, 'left': {'spInd': 0, 'spVal': 0.790312, 'right': {'spInd': 0, 'spVal': 0.786865, 'right': {'spInd': 0, 'spVal': 0.785574, 'right': {'spInd': 0, 'spVal': 0.777582, 'right': 100.838446, 'left': 107.024467}, 'left': 100.59882500000001}, 'left': {'spInd': 0, 'spVal': 0.787755, 'right': 118.642009, 'left': 110.15973}}, 'left': {'spInd': 0, 'spVal': 0.806158, 'right': {'spInd': 0, 'spVal': 0.799873, 'right': {'spInd': 0, 'spVal': 0.798198, 'right': 76.853728000000004, 'left': 91.368472999999994}, 'left': 62.877698000000002}, 'left': {'spInd': 0, 'spVal': 0.815215, 'right': {'spInd': 0, 'spVal': 0.811602, 'right': {'spInd': 0, 'spVal': 0.811363, 'right': 112.981216, 'left': 99.841379000000003}, 'left': 118.319942}, 'left': {'spInd': 0, 'spVal': 0.833026, 'right': {'spInd': 0, 'spVal': 0.823848, 'right': {'spInd': 0, 'spVal': 0.819722, 'right': 70.054507999999998, 'left': 59.342323}, 'left': 76.723834999999994}, 'left': {'spInd': 0, 'spVal': 0.841547, 'right': {'spInd': 0, 'spVal': 0.838587, 'right': 134.089674, 'left': 115.669032}, 'left': {'spInd': 0, 'spVal': 0.841625, 'right': 60.552307999999996, 'left': {'spInd': 0, 'spVal': 0.944221, 'right': {'spInd': 0, 'spVal': 0.85497, 'right': {'spInd': 0, 'spVal': 0.84294, 'right': 95.893130999999997, 'left': {'spInd': 0, 'spVal': 0.847219, 'right': 76.240983999999997, 'left': 89.20993}}, 'left': {'spInd': 0, 'spVal': 0.936524, 'right': {'spInd': 0, 'spVal': 0.934853, 'right': {'spInd': 0, 'spVal': 0.925782, 'right': {'spInd': 0, 'spVal': 0.910975, 'right': {'spInd': 0, 'spVal': 0.901444, 'right': {'spInd': 0, 'spVal': 0.901421, 'right': {'spInd': 0, 'spVal': 0.892999, 'right': {'spInd': 0, 'spVal': 0.888426, 'right': {'spInd': 0, 'spVal': 0.872199, 'right': {'spInd': 0, 'spVal': 0.866451, 'right': {'spInd': 0, 'spVal': 0.856421, 'right': 107.166848, 'left': 94.402101999999999}, 'left': 111.552716}, 'left': {'spInd': 0, 'spVal': 0.883615, 'right': {'spInd': 0, 'spVal': 0.872883, 'right': 95.887711999999993, 'left': 95.348184000000003}, 'left': {'spInd': 0, 'spVal': 0.885676, 'right': 108.045948, 'left': 94.896354000000002}}}, 'left': 82.436685999999995}, 'left': {'spInd': 0, 'spVal': 0.900699, 'right': {'spInd': 0, 'spVal': 0.896683, 'right': 107.00162, 'left': 109.188248}, 'left': 100.133819}}, 'left': 87.300624999999997}, 'left': {'spInd': 0, 'spVal': 0.908629, 'right': 118.513475, 'left': 106.814667}}, 'left': {'spInd': 0, 'spVal': 0.912161, 'right': 85.005351000000005, 'left': {'spInd': 0, 'spVal': 0.915263, 'right': 96.717609999999993, 'left': 92.074618999999998}}}, 'left': 115.75399400000001}, 'left': 65.548417999999998}, 'left': {'spInd': 0, 'spVal': 0.937766, 'right': 119.94982400000001, 'left': 100.12025300000001}}}, 'left': {'spInd': 0, 'spVal': 0.948822, 'right': 69.318648999999994, 'left': {'spInd': 0, 'spVal': 0.949198, 'right': 105.75250800000001, 'left': {'spInd': 0, 'spVal': 0.952377, 'right': 73.520802000000003, 'left': 100.649591}}}}}}}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.965969, 'right': {'spInd': 0, 'spVal': 0.956951, 'right': {'spInd': 0, 'spVal': 0.953902, 'right': 130.92648, 'left': {'spInd': 0, 'spVal': 0.954711, 'right': 100.935789, 'left': 82.016541000000004}}, 'left': {'spInd': 0, 'spVal': 0.958512, 'right': 135.83701300000001, 'left': {'spInd': 0, 'spVal': 0.960398, 'right': 123.559747, 'left': 112.386764}}}, 'left': {'spInd': 0, 'spVal': 0.968621, 'right': 98.648346000000004, 'left': 86.399636999999998}}}}}

myDat2Test = myRegTrees.loadDataSet('ex2test.txt')
myMat2Test = mat(myDat2Test)
print myRegTrees.prune(myTree, myMat2Test)
#{'spInd': 0, 'spVal': 0.499171, 'right': {'spInd': 0, 'spVal': 0.457563, 'right': {'spInd': 0, 'spVal': 0.455761, 'right': {'spInd': 0, 'spVal': 0.126833, 'right': {'spInd': 0, 'spVal': 0.124723, 'right': {'spInd': 0, 'spVal': 0.085111, 'right': {'spInd': 0, 'spVal': 0.084661, 'right': {'spInd': 0, 'spVal': 0.080061, 'right': {'spInd': 0, 'spVal': 0.068373, 'right': {'spInd': 0, 'spVal': 0.061219, 'right': {'spInd': 0, 'spVal': 0.044737, 'right': 4.0916259999999998, 'left': {'spInd': 0, 'spVal': 0.053764, 'right': -13.731698, 'left': {'spInd': 0, 'spVal': 0.055862, 'right': -3.131497, 'left': 6.6955669999999996}}}, 'left': -15.160836}, 'left': 15.824970500000001}, 'left': -24.132225999999999}, 'left': 37.820658999999999}, 'left': {'spInd': 0, 'spVal': 0.108801, 'right': {'spInd': 0, 'spVal': 0.10796, 'right': {'spInd': 0, 'spVal': 0.085873, 'right': -10.137104000000001, 'left': -1.2931950000000001}, 'left': -16.106164}, 'left': 6.1965159999999999}}, 'left': 22.891674999999999}, 'left': {'spInd': 0, 'spVal': 0.130626, 'right': -39.524461000000002, 'left': {'spInd': 0, 'spVal': 0.382037, 'right': {'spInd': 0, 'spVal': 0.335182, 'right': {'spInd': 0, 'spVal': 0.324274, 'right': {'spInd': 0, 'spVal': 0.309133, 'right': {'spInd': 0, 'spVal': 0.131833, 'right': 22.478290999999999, 'left': {'spInd': 0, 'spVal': 0.138619, 'right': -29.087463, 'left': {'spInd': 0, 'spVal': 0.156067, 'right': {'spInd': 0, 'spVal': 0.13988, 'right': 7.3367839999999998, 'left': 7.5573490000000003}, 'left': {'spInd': 0, 'spVal': 0.166765, 'right': {'spInd': 0, 'spVal': 0.156273, 'right': 0.225886, 'left': {'spInd': 0, 'spVal': 0.164134, 'right': -27.405211000000001, 'left': {'spInd': 0, 'spVal': 0.166431, 'right': -6.5125060000000001, 'left': -14.740059}}}, 'left': {'spInd': 0, 'spVal': 0.193282, 'right': 9.5773855000000001, 'left': {'spInd': 0, 'spVal': 0.211633, 'right': {'spInd': 0, 'spVal': 0.202161, 'right': -2.6781804999999999, 'left': -16.427370249999999}, 'left': {'spInd': 0, 'spVal': 0.228473, 'right': 6.0992389999999999, 'left': {'spInd': 0, 'spVal': 0.25807, 'right': {'spInd': 0, 'spVal': 0.228628, 'right': -2.266273, 'left': {'spInd': 0, 'spVal': 0.228751, 'right': -30.812912000000001, 'left': -9.601409499999999}}, 'left': {'spInd': 0, 'spVal': 0.284794, 'right': {'spInd': 0, 'spVal': 0.273863, 'right': {'spInd': 0, 'spVal': 0.264926, 'right': {'spInd': 0, 'spVal': 0.264639, 'right': 2.5579230000000002, 'left': 5.2805790000000004}, 'left': -9.4575560000000003}, 'left': 35.623745999999997}, 'left': {'spInd': 0, 'spVal': 0.300318, 'right': {'spInd': 0, 'spVal': 0.297107, 'right': {'spInd': 0, 'spVal': 0.295993, 'right': {'spInd': 0, 'spVal': 0.290749, 'right': -14.391613, 'left': -14.988279}, 'left': -1.7983769999999999}, 'left': -18.051317999999998}, 'left': 8.8147249999999993}}}}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.310956, 'right': -49.939515999999998, 'left': -20.397333499999998}}, 'left': 22.286959625000001}, 'left': {'spInd': 0, 'spVal': 0.370042, 'right': {'spInd': 0, 'spVal': 0.35679, 'right': {'spInd': 0, 'spVal': 0.350725, 'right': -26.851234812500003, 'left': -9.9938275000000001}, 'left': -32.124495000000003}, 'left': {'spInd': 0, 'spVal': 0.378965, 'right': {'spInd': 0, 'spVal': 0.373501, 'right': -8.2282969999999995, 'left': {'spInd': 0, 'spVal': 0.377383, 'right': 5.2411960000000004, 'left': 13.583555}}, 'left': -29.007783}}}, 'left': {'spInd': 0, 'spVal': 0.388789, 'right': 23.197474, 'left': {'spInd': 0, 'spVal': 0.437652, 'right': {'spInd': 0, 'spVal': 0.412516, 'right': {'spInd': 0, 'spVal': 0.403228, 'right': 0.63593000000000011, 'left': -26.419288999999999}, 'left': {'spInd': 0, 'spVal': 0.418943, 'right': 44.161493, 'left': {'spInd': 0, 'spVal': 0.426711, 'right': -21.594268, 'left': {'spInd': 0, 'spVal': 0.428582, 'right': 15.224266, 'left': 19.745224}}}}, 'left': -4.1911744999999998}}}}}, 'left': -34.044555000000003}, 'left': {'spInd': 0, 'spVal': 0.465561, 'right': {'spInd': 0, 'spVal': 0.463241, 'right': 17.171057000000001, 'left': 30.051931}, 'left': {'spInd': 0, 'spVal': 0.467383, 'right': {'spInd': 0, 'spVal': 0.46568, 'right': -23.777531, 'left': -9.7129250000000003}, 'left': {'spInd': 0, 'spVal': 0.483803, 'right': 5.224234, 'left': {'spInd': 0, 'spVal': 0.487381, 'right': 27.729263, 'left': 8.5367700000000006}}}}}, 'left': {'spInd': 0, 'spVal': 0.729397, 'right': {'spInd': 0, 'spVal': 0.640515, 'right': {'spInd': 0, 'spVal': 0.613004, 'right': {'spInd': 0, 'spVal': 0.606417, 'right': {'spInd': 0, 'spVal': 0.513332, 'right': {'spInd': 0, 'spVal': 0.508548, 'right': {'spInd': 0, 'spVal': 0.508542, 'right': 96.403373000000002, 'left': 93.292828999999998}, 'left': 101.075609}, 'left': {'spInd': 0, 'spVal': 0.533511, 'right': {'spInd': 0, 'spVal': 0.51915, 'right': 116.17616200000001, 'left': {'spInd': 0, 'spVal': 0.531944, 'right': 124.795495, 'left': 129.76674299999999}}, 'left': {'spInd': 0, 'spVal': 0.548539, 'right': {'spInd': 0, 'spVal': 0.546601, 'right': {'spInd': 0, 'spVal': 0.537834, 'right': 90.995536000000001, 'left': 97.340526499999996}, 'left': 83.114502000000002}, 'left': {'spInd': 0, 'spVal': 0.553797, 'right': 129.06244849999999, 'left': {'spInd': 0, 'spVal': 0.560301, 'right': 82.903944999999993, 'left': {'spInd': 0, 'spVal': 0.599142, 'right': {'spInd': 0, 'spVal': 0.589806, 'right': {'spInd': 0, 'spVal': 0.582311, 'right': {'spInd': 0, 'spVal': 0.571214, 'right': {'spInd': 0, 'spVal': 0.569327, 'right': 108.43539199999999, 'left': 114.872056}, 'left': 82.589327999999995}, 'left': 111.9849935}, 'left': 130.37852899999999}, 'left': 93.521395999999996}}}}}}, 'left': 168.180746}, 'left': {'spInd': 0, 'spVal': 0.623909, 'right': 82.04976400000001, 'left': {'spInd': 0, 'spVal': 0.628061, 'right': {'spInd': 0, 'spVal': 0.624827, 'right': 105.970743, 'left': 117.62834599999999}, 'left': {'spInd': 0, 'spVal': 0.637999, 'right': {'spInd': 0, 'spVal': 0.632691, 'right': 93.645292999999995, 'left': 91.656616999999997}, 'left': 82.713621000000003}}}}, 'left': {'spInd': 0, 'spVal': 0.642373, 'right': 140.61394100000001, 'left': {'spInd': 0, 'spVal': 0.642707, 'right': 82.500765999999999, 'left': {'spInd': 0, 'spVal': 0.665329, 'right': {'spInd': 0, 'spVal': 0.661073, 'right': {'spInd': 0, 'spVal': 0.652462, 'right': 112.715799, 'left': 115.687524}, 'left': 121.98060700000001}, 'left': {'spInd': 0, 'spVal': 0.706961, 'right': {'spInd': 0, 'spVal': 0.698472, 'right': {'spInd': 0, 'spVal': 0.689099, 'right': {'spInd': 0, 'spVal': 0.666452, 'right': 112.78136649999999, 'left': 101.91115275}, 'left': 120.521925}, 'left': {'spInd': 0, 'spVal': 0.69892, 'right': 92.470635999999999, 'left': {'spInd': 0, 'spVal': 0.699873, 'right': 115.58660500000001, 'left': {'spInd': 0, 'spVal': 0.70639, 'right': 105.062147, 'left': 106.18042699999999}}}}, 'left': {'spInd': 0, 'spVal': 0.70889, 'right': 135.41676699999999, 'left': {'spInd': 0, 'spVal': 0.716211, 'right': {'spInd': 0, 'spVal': 0.710234, 'right': 108.55391899999999, 'left': 103.345308}, 'left': 110.90282999999999}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.952833, 'right': {'spInd': 0, 'spVal': 0.759504, 'right': 78.085643250000004, 'left': {'spInd': 0, 'spVal': 0.763328, 'right': 115.199195, 'left': {'spInd': 0, 'spVal': 0.769043, 'right': 64.041940999999994, 'left': {'spInd': 0, 'spVal': 0.790312, 'right': {'spInd': 0, 'spVal': 0.786865, 'right': 102.26514075, 'left': 114.4008695}, 'left': {'spInd': 0, 'spVal': 0.806158, 'right': 73.494399250000001, 'left': {'spInd': 0, 'spVal': 0.815215, 'right': {'spInd': 0, 'spVal': 0.811602, 'right': {'spInd': 0, 'spVal': 0.811363, 'right': 112.981216, 'left': 99.841379000000003}, 'left': 118.319942}, 'left': {'spInd': 0, 'spVal': 0.833026, 'right': {'spInd': 0, 'spVal': 0.823848, 'right': {'spInd': 0, 'spVal': 0.819722, 'right': 70.054507999999998, 'left': 59.342323}, 'left': 76.723834999999994}, 'left': {'spInd': 0, 'spVal': 0.841547, 'right': 124.87935300000001, 'left': {'spInd': 0, 'spVal': 0.841625, 'right': 60.552307999999996, 'left': {'spInd': 0, 'spVal': 0.944221, 'right': {'spInd': 0, 'spVal': 0.85497, 'right': {'spInd': 0, 'spVal': 0.84294, 'right': 95.893130999999997, 'left': {'spInd': 0, 'spVal': 0.847219, 'right': 76.240983999999997, 'left': 89.20993}}, 'left': {'spInd': 0, 'spVal': 0.936524, 'right': {'spInd': 0, 'spVal': 0.934853, 'right': {'spInd': 0, 'spVal': 0.925782, 'right': {'spInd': 0, 'spVal': 0.910975, 'right': {'spInd': 0, 'spVal': 0.901444, 'right': {'spInd': 0, 'spVal': 0.901421, 'right': {'spInd': 0, 'spVal': 0.892999, 'right': {'spInd': 0, 'spVal': 0.888426, 'right': {'spInd': 0, 'spVal': 0.872199, 'right': 106.16859550000001, 'left': 98.544549499999988}, 'left': 82.436685999999995}, 'left': {'spInd': 0, 'spVal': 0.900699, 'right': 108.09493399999999, 'left': 100.133819}}, 'left': 87.300624999999997}, 'left': {'spInd': 0, 'spVal': 0.908629, 'right': 118.513475, 'left': 106.814667}}, 'left': {'spInd': 0, 'spVal': 0.912161, 'right': 85.005351000000005, 'left': 94.396114499999996}}, 'left': 115.75399400000001}, 'left': 65.548417999999998}, 'left': 110.03503850000001}}, 'left': {'spInd': 0, 'spVal': 0.948822, 'right': 69.318648999999994, 'left': 96.41885225}}}}}}}}}}}, 'left': {'spInd': 0, 'spVal': 0.965969, 'right': {'spInd': 0, 'spVal': 0.956951, 'right': 111.2013225, 'left': {'spInd': 0, 'spVal': 0.958512, 'right': 135.83701300000001, 'left': {'spInd': 0, 'spVal': 0.960398, 'right': 123.559747, 'left': 112.386764}}}, 'left': 92.523991499999994}}}}

# 9.5 模型树

reload(myRegTrees)
myMat2 = mat(myRegTrees.loadDataSet('exp2.txt'))

myTree = myRegTrees.createTree(myMat2, myRegTrees.modelLeaf, myRegTrees.modelErr, (1,10))
print myTree

# 9.6 示例：树回归与标准回归的比较

trainMat = mat(myRegTrees.loadDataSet('bikeSpeedVsIq_train.txt'))
testMat = mat(myRegTrees.loadDataSet('bikeSpeedVsIq_test.txt'))

myTree = myRegTrees.createTree(trainMat, ops = (1,20))
yHat = myRegTrees.createForeCast(myTree, testMat[:,0])
print corrcoef(yHat, testMat[:,1], rowvar=0)[0,1]

myTree = myRegTrees.createTree(trainMat,  myRegTrees.modelLeaf, myRegTrees.modelErr, (1,20))
yHat = myRegTrees.createForeCast(myTree, testMat[:,0], myRegTrees.modelTreeEval)
print corrcoef(yHat, testMat[:,1], rowvar=0)[0,1]

ws,X,Y = myRegTrees.linearSolve(trainMat)
print  ws

for i in range(shape(testMat)[0]):
    yHat[i]=testMat[i,0]*ws[1,0]+ws[0,0]
    
print corrcoef(yHat, testMat[:,1], rowvar=0)[0,1]


# 9.7 使用Python的Tkinter库创建GUI



